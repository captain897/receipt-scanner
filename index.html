<!DOCTYPE html>
<html>
<head>
    <title>Widget Test</title>
    <script src="https://js.jotform.com/JFCustomWidget.min.js"></script>
</head>
<body>
    <div style="padding: 20px; font-family: sans-serif;">
        <div id="line1">1. Waiting...</div>
        <div id="line2">2. Waiting...</div>
        <div id="line3">3. Waiting...</div>
        <div id="line4">4. Waiting...</div>
    </div>
    
    <script>
        document.getElementById('line1').textContent = '1. Script executed ✓';
        
        function initWidget() {
            if (typeof JFCustomWidget !== 'undefined') {
                document.getElementById('line2').textContent = '2. JFCustomWidget found ✓';
                
                JFCustomWidget.subscribe("ready", function() {
                    document.getElementById('line3').textContent = '3. Ready event received ✓';
                });
                
                JFCustomWidget.subscribe("submit", function() {
                    document.getElementById('line4').textContent = '4. Submit event - sending...';
                    JFCustomWidget.sendSubmit({ valid: true, value: "test" });
                    document.getElementById('line4').textContent = '4. Submit sent ✓';
                });
            } else {
                // Try again in 500ms, up to 10 times
                if (!window.attempts) window.attempts = 0;
                window.attempts++;
                document.getElementById('line2').textContent = '2. Waiting for JFCustomWidget... (attempt ' + window.attempts + ')';
                if (window.attempts < 10) {
                    setTimeout(initWidget, 500);
                } else {
                    document.getElementById('line2').textContent = '2. JFCustomWidget NOT found after 5s';
                    document.getElementById('line3').textContent = '3. N/A';
                    document.getElementById('line4').textContent = '4. N/A';
                }
            }
        }
        
        // Start checking
        initWidget();
    </script>
</body>
</html>
